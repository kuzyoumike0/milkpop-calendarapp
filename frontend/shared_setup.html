<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>共有設定 | MilkPop</title>
  <link rel="stylesheet" href="assets/app.css"/>
  <script src="assets/simple_calendar.js"></script>
</head>
<body>
  <header class="app-header">
    <img src="assets/logo.png" class="logo" alt="logo"/>
    <h1>共有設定</h1>
  </header>
  <main class="container card">
    <div class="row" style="gap:10px;align-items:center">
      <input id="title" class="w100 fancy" placeholder="タイトル（例：飲み会候補）" style="max-width:320px">
      <div class="seg">
        <button id="modeMulti" class="seg-btn active">複数選択</button>
        <button id="modeRange" class="seg-btn">範囲選択</button>
      </div>
    </div>
    <div id="calWrap" class="mt8"></div>
    <div class="row mt8">
      <button id="issue" class="primary">リンク発行</button>
      <div id="result" class="status"></div>
    </div>
  </main>
  <script>
    const cal = SimpleCalendar.createCalendar(document.getElementById('calWrap'), {
      defaultMode:'multi',
      onChange: (dates)=>{ /* optional preview */ }
    });
    const btnM = document.getElementById('modeMulti');
    const btnR = document.getElementById('modeRange');
    function setActive(m){
      cal.setMode(m);
      btnM.classList.toggle('active', m==='multi');
      btnR.classList.toggle('active', m==='range');
    }
    btnM.onclick=()=>setActive('multi');
    btnR.onclick=()=>setActive('range');

    document.getElementById('issue').onclick = async ()=>{
      const title = document.getElementById('title').value || '共有スケジュール';
      const allowed_dates = cal.getSelected();
      const r = await fetch('/api/shared/session', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ title, allowed_dates }) });
      const t = await r.json();
      const el = document.getElementById('result');
      if(!r.ok){ el.textContent='発行失敗: '+JSON.stringify(t); return; }
      el.innerHTML = 'リンク: <a href="'+ (t.url || ('/share_session.html?token='+t.token)) +'" target="_blank">共有ページを開く</a>';
    };
  </script>
</body>
</html>
